"use strict";var runUrl=window.runUrl,firstStage=window.firstStage,finishedRedirectUrl=window.finishedRedirectUrl,submissionsStageName="status-submissions",migrateSubmissions=!1,submissionFormsCount=0,submissionFormsProcessed=0;$(document).ready(function(){function s(n,o,r){var a=n["type-name"],m=n["in-progress-text"];if(submissionFormsProcessed>0&&a===submissionsStageName&&submissionFormsCount>0&&migrateSubmissions===!0){var c=Math.round(submissionFormsProcessed/submissionFormsCount*100);m+=" "+c+"%"}t(m,!0);var p={stage:a,nextForm:o,nextPage:r};$.ajax({type:"post",contentType:"application/x-www-form-urlencoded; charset=UTF-8",cache:!1,url:runUrl,dataType:"json",timeout:5e7,data:p}).done(function(n){console.log("Successfully ran "+n.stage);var a=n.success,m=n.nextStage,c=n.stage,p=n.finished;if(a){if(n.stage["type-name"]===submissionsStageName&&migrateSubmissions){submissionFormsCount=n.submissionsInfo.formsCount,o=n.submissionsInfo.nextForm;var g=n.submissionsInfo.finishedForm;r=n.submissionsInfo.nextPage,g===!0&&(submissionFormsProcessed+=1,console.log("Submission forms processed: "+submissionFormsProcessed))}p===!1?migrateSubmissions||m["type-name"]!==submissionsStageName?n.stage["type-name"]===submissionsStageName?s(n.stage,o,r):m&&(u(c["in-progress-text"]),s(m,null,null)):(u(c["in-progress-text"]),e(n)):e(n)}else t(c["in-progress-text"],!0),i()}).error(function(s,e,n){console.log("Something went wrong: "+jQuery.parseJSON(s.responseText).errors)})}function e(s){s.stage["type-name"]===submissionsStageName&&u(s.stage["in-progress-text"]),n(),r()}function n(){$("#in-progress-status-footer").hide()}function o(){$("#ready-wrapper").hide(),$("#in-progress-wrapper").show()}function i(){$("#in-progress-error-wrapper").show()}function r(){$("#in-progress-success-wrapper").show()}function t(s,e){var n=$("#in-progress-status-footer");n.empty(),n.text(a(s,e))}function a(s,e){return e?s+"...":s+'...<span class="in-progress-error">error!</span>'}function u(s){var e=$("#in-progress-status-wrapper");e.append(m(s))}function m(s){return'<div class="in-progress-status">'+s+'...<span class="in-progress-complete">complete!</span></div>'}function c(){migrateSubmissions=$("#migrate-submissions").first().is(":checked")}$("#start-migration-button").click(function(e){c(),o(),s(firstStage,null,null)})});